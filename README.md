# Tor Proxy Squid Server
Настройка кластера для направления трафика через несколько шлюзов в зависимости от состояния их доступности.
## Из чего состоит
### Torrc
Множество шлюзов запускаемых на кластере серверов.
Чтобы Socks5 шлюз перезапускался в случае блокировки сервера с которым он пытается связаться используется опция Healthckeck 
```
curl -sx socks5h://localhost:9050 'https://check.torproject.org/' | grep -qm1 Congratulations
```
Где сначала идёт запрос страницы которая 100% заблокированна и используются для тестирования доступности с опциями:
* `-s` - запустить в тихом режиме не выводя запрашиваемую страницу
* `-x` - Использовать прокси где указывается [протокол://адресс[:порт]], в нашем случае 'socks5://localhost:9050/' Более подробно можно почитать [тут](https://blog.emacsos.com/use-socks5-proxy-in-curl.html).Естественно более подробно в офф документации `curl --help -s`

Далее с запрашиваемой страницы стараемся извлечь текст об успешности `Congratulations` в тихом режиме не выводя сам текст а возвращая лишь 0 или 1:
* `-q` - работать в тихом режиме и вернуть 0 если есть совпадение и 1 если нету, применимо для включения в условия  (if curl -sx socks5h://localhost:9050 'https://check.torproject.org/' | grep -qm1 Congratulations; then echo "load"; else echo "unload"; fi)
* `-m` - остановить поиск совпадений до указанного числа совпадений, тобишь если текст в скачанном документе попадётся то на этом проверка его закончится

####
